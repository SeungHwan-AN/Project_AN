# 서비스 시스템 구성

## 1. 전체 시스템 흐름도

* client : 안드로이드 -> Server : Apache -> Database : MariaDB

## 2. 각 컴포넌트에서 많이, 자주 쓰이는 기술

### 1. client

* 안드로이드
	- 세계에서 가장 대표적인 오픈소스 플랫폼
		- 오픈소스 :  제품을 개발하는 과정에 필요한 소스 코드나 설계도를 누구나 접근해서 열람할 수 있도록 공개
		- 보통 2차 창작이나 상업적 용도의 사용도 허가하는 경우가 많다
	- 구성 언어 : C, C++, java
	- 리눅스 기반
	- java 가상머신을 사용하여 성능은 좀 떨어질 수 있다
		- java 가상머신 : java로 개발한 프로그램을 컴파일하여 만들어지는 바이트코드를 실행시키기 위한 가상머신
			+ 가상머신 : 컴퓨터가 만들어내는 가상의 컴퓨터
				1. 프로세스 가상머신 : 하나의 프로세스만을 위해 생성, 그 프로세스가 끝나면 없어짐
				2. 시스템 가상머신
				+  실제로 존재하지 않는 기계를 에뮬레이트하고, 프로그래밍 언어의 하드웨어 추상화를 위해 사용
			+ 바이트코드 : 고급 언어로 작성된 소스 코드를 가상머신이 이해할 수 있는 중간 코드로 컴파일한 것
				+ 어셈블리어에 가까운 형태
				+ 바이트코드와 가상머신은 거의 항상 함께 존재
				+ 왜냐하면 기계어와 같이 효율적으로 저장하고 불러올 수 있는 형식 필요
		- 가상머신은 이 바이트코드를 각각의 하드웨어 아키텍처에 맞는 기계어로 다시 컴파일
		- 코드 최적화와 백엔드를 담당
		- 썬 마이크로 시스템즈에서 개발 -> 오라클에 인수되어 오라클이 모든 권한을 현재 행사
			+ 썬 마이크로 시스템즈 : 앤디 벡톨샤임, 비노드 코슬라, 스콧 맥닐리가 설립
				1. 현재 오라클에 인수 합병됨
				2. 이름인 Sun은 Stanford University Network에서 따왔다
				3. 스콧 맥닐리는 마이크로 소프트를 아주 싫어했음
					- 왜냐하면 마이크로소프트는 썬의 자바 기술에 대한 특허권을 침해했다가 썬과의 소송에서 패소하여 20억 달러를 내준 경험도 있기 때문
				4. 썬OS(SunOS)나 솔라리스(Solaris)와 같은 운영 체제를 개발해서 유닉스의 역사에서도 매우 중요한 위치를 차지했었음
				5. 스팍(SPARC) 계열 역시 RISC CPU 개발의 한 축을 이루었었음
				6. java의 개발로 대중적으로 유명해짐
				7. 마이크로소프트의 CEO인 사티아 나델라는 썬 마이크로시스템즈에서 일을 했던 적이 있다
	- 하지만 호환성이 매우 막강하여 다른 플랫폼으로도 포팅이 가능하다
		- 포팅(or 이식) :  소프트웨어를 다른 CPU나 운영 체제에서도 쓸 수 있도록 수정하는 것
			+ 처음부터 여러 플랫폼에서 사용할 수 있도록 만드는 크로스 플랫폼과는 다르다
			+ 예시 : 윈도우즈용 한컴오피스 한글을 맥이나 리눅스에서도 쓸 수 있게 프로그램을 수정하는 것

* ios
	- 애플이 생산하는 제품 중 모바일 기기에 탑재되는 운영 체제
	- 매년 WWDC에서 새 버전이 공개
	- 이름이 원래 CISCO의 장비 OS 이름이기 때문에, CISCO에서 라이선스를 사서 사용
		- 닌텐도 Wii의 OS 이름도 iOS
	- macOS를 이용해 개발되었으므로 Darwin OS를 베이스로 한다
		1. macOS
			- Mac 전용 운영 체제
			- 2016년 6월 13일, WWDC에서 다음 버전 OS 시에라를 발표하며 명칭이 OS X에서 macOS로 바뀜
			- 대부분의 사용자 레벨 아래 작업을 운영 체제나 프로그램이 적절히 처리한다는 특징이 있음
				+ 장점 : 사용자가 쾌적한 환경을 유지하기 위해 시스템 관리에 많은 시간을 투자할 필요성이 없다
				+ 단점 : 갑자기 시스템 파일 권한이 꼬인다거나 하는 식으로 자기 혼자 문제를 일으킬 수도 있어서 "시한부적 시스템"이라고도 부름
			- 레지스트리가 없어 특정 프로그램에 의해서, 혹은 사용자에 의해서 운영 체제 전체가 총체적으로 맛이 갈 확률이 상대적으로 낮다
				+ 이는 유닉스 기반 운영 체제의 특성
			- 부팅속도는 레지스트리가 없는 만큼 macOS가 더 빠르지만 프로그램의 구동은 동일사양에서는 윈도우가 더 빠르다
				+ 파일형 라이브러리로 안정성을 확보하지만 퍼포먼스는 떨어짐
			- 2016년 이후로 나오는 macOS 기기들의 경우 내부에 들어가는 PCI-E 기반 SSD의 속도가 매우 빠름
			- 그런데 2018년부로 애플은 macOS Server 버전에서 DHCP, DNS, VPN 등의 기능들을 대거 삭제
			- 서드파티 앱들도 애플의 가이드라인을 충실하게 따르도록 하여 앱간 연동이 많이 발달
		2. Darwin
			- 애플이 사용하는 운영 체제의 기반
			- XNU 커널을 기반으로 혼자서도 돌아가는 독립형 운영 체제
			- 오픈소스
			- Darwin이 새 버전을 업데이트하면 그것 위에 코코아 프레임워크 등을 올려서 macOS, iOS 새 버전을 만드는 식으로 진행
	- Darwin은 Mach 커널과 BSD 커널로 이루어진 XNU 커널로 만들어졌기 때문에 iOS는 일종의 유닉스 기반
		1. Mach 커널
			- 1985년에 카네기 멜런 대학교에서 개발한 마이크로 커널
			- 운영 체제 연구의 목적으로 개발
			- 분산 및 병렬 연산 지원을 목표로 개발
		2. BSD
			- 빌 조이(Bill Joy)를 주축으로 캘리포니아 대학교 버클리 캠퍼스(University of California, Berkeley)의 CSRG(Computer Systems Research Group)에서 개발한 유닉스 계열의 운영 체제
			- 1995년 6월 4.4BSD-Lite Release 2 출시를 끝으로 공식 BSD 프로젝트가 중단
			- 현재는 BSD에서 파생된 운영 체제를 모두 의미함
			- Berkeley Software Distribution의 이니셜
			-  BSD 라이선스로 배포되며 GPL과는 달리 자기가 소스 코드를 수정 및 추가해도 소스 코드 공개 의무가 없다
				+ 따라서 macOS, iOS, 솔라리스, TmaxOS 등의 상업적인 운영 체제에도 많이 사용
			- 데스크탑 환경과 응용 소프트웨어를 모두 포함하여 개발 및 배포
	- 현재 시장 점유율 28.24%

### 2. server

* Apache
	- 리눅스에서 NCSA HTTPd(최초의 웹서버 프로그램)을 구동하기 위해 만든 웹서버 프로그램
		- NCSA HTTPd : 팀 버너스 리가 만든 최초의 웹 서버 프로그램
			+ 유닉스 기반
		- 팀 버너스 리
			+ www, URL, HTTP 등을 고안하여 인터넷을 탄생
			+ 영국의 컴퓨터 학자
			+ 왕립학회의 회원(FRS)으로 활동 중
			+ 현재는 월드와이드웹 컨소시엄(W3C) 소장으로 재직
	- 리눅스가 서버 OS 최다 점유율을 차지하자 Apache도 최다 점유율 차지
	- 모듈이라는 개념으로 수많은 기능을 덧붙일 수 있어 확장성이 매우 높다
	- 다른 서버 사이드 언어나 DBMS와 잘 맞는다
		- 초창기 : Perl, 그 뒤로는 PHP 사용
			+ 이때 PHP 모듈을 통해 PHP를 실행할 수도 있지만, 속도 향상을 위해 주로 PHP-FPM을 통해 PHP를 연결해서 사용
			1. PHP
				+ 대표적인 서버 사이드 스크립트 언어
					- 서버 사이드 스크립트 언어
				+ 전 세계 수많은 웹 시스템의 기반
				+ C-like 문법을 사용하여, 소규모 웹 페이지 제작시 쉽고 빠르다는 점에서 사용자, 사용처가 많다
					- C-like 문법 : C언어에서 파생된 문법
				+ 비슷한 언어로는 ASP, JSP, ROR
					- ASP
						- 마이크로소프트가 인터넷 정보 서비스(IIS)에서 동적 웹 페이지 생성 용도로 사용할 것을 목적으로 제작한 서버 사이드 스크립트 엔진
						- 확장자는 .asp 를 사용
						- 1996년 출시된 IIS 3.0부터 기본으로 포함되기 시작
						- 여러 가지 언어를 지원
						- 윈도우에서 지원하는 기존 프로그래밍 언어를 웹에서 쓸 수 있도록 하는 일종의 기술
						- 개발툴이 비주얼 스튜디오라서 윈도우 개발자라면 어렵지 않게 ASP로 개발이 가능하다는 장점이 있음
						- 2002년에 ASP.NET으로 대체
						- ASP는 2020년까지 지원이 예정
						- 현재는 신규 프로젝트에는 거의 쓰이지 않고 있고, 기존에 구축해놓은 솔루션의 유지보수용으로 사용
					- JSP
						- Java를 이용한 서버 사이드 스크립트 언어
						- JavaServer Pages의 약자
						- Java의 점유율을 대폭 상승시킨 주 원인
						- 확장자는 .jsp
						- 주로 대규모 기업용 시스템 구축에 사용
						- 안정적이고, 유지보수가 쉽다
						- 
					- ROR
						- Ruby를 사용하는 웹 프레임워크
							+ Ruby
								- 스크립트 언어의 일종
								- 창시자는 마츠모토 유키히로(Matz)로 1995년에 발표
								- 언어의 문법이 쉽고 확장이 편리
								- Python은 서로 영향을 주고 받는 라이벌 관계
								- 객체 지향 프로그래밍 언어
								- 세계 10대 프로그래밍 언어
								- 2015년 기준 GitHub에서 인기언어 3위
								- 웹 개발에서는 백엔드에 Ruby on Rails와 함께 많이 쓰임
								- 임베디드에도 많이 사용
						- 덴마크의 David Heinemeier Hansson이 오픈 소스로 제작
						- 풀 스택 웹 프레임워크
				+ 1995년 라스무스 러돌프에 의하여 처음 공개
				+ The PHP Group이라는 단체에서 개발 및 관리
				+ PHP - Hypertext Preprocessor의 재귀 약자 사용
				+ 우리나라에서 엄청난 점유율을 보이는 XpressEngine과 그누보드 역시 PHP로 제작
		- 특히 MySQL과 잘 맞아 APM(Apache + PHP + MySQL)이라는 웹서버를 돌리기 위한 조합이 탄생
	- 자체 라이선스인 아파치 라이선스 2.0 사용
		- 아파치 소프트웨어 재단에서 만들었다는 사실을 밝히고 아파치 라이선스를 따르면 자유롭게 수정 및 재배포가 가능
		- 소스 공개 강제 사항도 없는 자유로운 라이선스
	- 2.2 버전대에서 너무 무겁다는 평이 많았다
	- 하지만 Event MPM을 탑재하여 속도를 크게 개선한 2.4 버전을 내놓음으로 개선
	- 윈도우용도 존재
		- XAMPP나 APMSetup 등의 아파치 웹 서버+PHP+MySQL을 편리하게 통합해 설치할 수 있는 패키지가 있다
	- 약 45%의 시장 점유율

* NGINX
	- 러시아의 프로그래머 이고르 시쇼브가 개발
		- Apache HTTPd를 코딩하다 Apache의 C10K 문제를 겪고 개발 시작
			+ C10K
				+ 10,000개 이상의 소켓을 열게 된다면 하드웨어 성능이 충분함에도 불구하고 I/O 처리 방식의 문제 때문에 프로세스가 제대로 처리하지 못하는 문제
		- 2004년 스푸트니크 1호 발사일에 발표
	- 네이티브 Win32 환경에도 돌아갈 무설치 웹서버 프로그램을 개발하기 위해 만든 프로그램
	- 목표는 가벼우면서도 강력한 프로그램
	- 오픈소스
	- HTTP, 리버스 프록시, IMAP/POP3 등의 서버 구동 가능
	- java 서블릿은 Apache의 톰캣을 연동해서 구현
		- 톰캣
			+ Tomcat은 수컷 고양이를 뜻하는 영어 단어
			+ 아파치 소프트웨어 재단에서 개발하는 Java 기반의 웹 서버이자 서블릿 컨테이너 프로그램
			+ 썬 마이크로시스템즈에서 1990년대에 Java 웹 애플리케이션 표준인 서블릿/JSP를 개발하기 시작
			+ 이것의 표준 구현을 개발하던 것을 나중에 오픈소스화하여 공개한 것에서 톰캣이 시작됨
			+ 서블릿/JSP 엔진만 들어있다
			+ JSP 사용자가 크게 늘어난 원인
				+ ASP는 쓰는 사람만 쓰는 언어가 되었다
	- PHP는 PHP-FPM을 이용해서 구현
	- Apache 다음으로 높은 약 20.65%의 시장 점유율
		- 신규 서비스를 중심으로 점유율이 상승중
		- 이미 Apache HTTPd가 많은 한계를 많이 보이고 있어, 특별한 사유가 없다면 nginx로 갈아타는 추세
	- 구조적 특징
		- Apache HTTPd에서 사용하는 요청 당 스레드 기반 작동
		- 또는 프로세스 기반의 구조 대신 비동기 이벤트 기반의 구조로 작동
			+ 서버 부하시 성능 예측이 쉽다
		- 리눅스 기반으로 구축하는 웹 서버의 경우 LEMP(Linux + Enginx + MySQL + PHP or Python or Perl) 사용
		- 여러 서드파티 기능을 모듈로 쓰고 있다
			+ 필요하지 않을 경우 모듈 제외 가능
		- 완성된 바이너리를 사용하지 않고 소스를 컴파일해서 사용할 때 처음부터 사용할 모듈을 추가하지 않으면 그 이후에 추가가 불가능한 단점이 있다
		- 환경 설정을 바꾸고 나서 서버 데몬을 재시작할 필요 없이 reload 시그널을 보내기만 하면 된다
			+ 프로세스를 재시작할 필요가 없다는 장점
	- 현재 HTTP/2를 지원하기 위해 노력중
		- HTTP/2
			+ 2015년 IETF에 의해 공식적으로 발표
			+ HTTP/1.1의 차기 버전
			+ 등장배경
				+ 웹 기술이 발전함에 따라 사진, 동영상 등과 같은 고용량의 멀티미디어 데이터를 전송하는 일이 많아짐
				+ 모바일 시장이 엄청나게 성장
			+ 구글이 자체적으로 SPDY라는 프로토콜을 개발함으로써 HTTP/2 개발을 촉진
			+ 2012년, IETF에서 HTTP/2의 첫 Draft로 SPDY의 구조를 채택
				+ 현재의 HTTP/2의 구조와 기능이 SPDY와 유사
			+ TLS를 요구하기 때문에 443 포트를 사용
				+ TLS
					- 인터넷에서의 정보를 암호화해서 송수신하는 프로토콜
					- 넷스케이프 커뮤니케이션스사가 개발한 SSL(Secure Sockets Layer)에 기반한 기술
					- 국제 인터넷 표준화 기구에서 표준으로 인정받은 프로토콜
			+ 비교적 최신의 서버 환경을 구축 필요
	- 윈도우용 nginx는 아직 불완전한 버전
		- 본래의 성능이나 확장성을 발휘하지 못하며 UDP 관련 기능도 지원하지 않는다
	- 사용 사이트
		- 넷플릭스, 청와대, 페이스북, GitHub, SoundCloud...

### 3. cache server

* redis
	- remote dictionary server의 약자
	- 2009년 살바토르 산필리포(Salvatore Sanfilippo)가 처음 개발
	- 오픈소스 기반의 비관계형 데이터베이스 관리 시스템(DBMS)
		- 모든 데이터를 메모리로 불러와서 처리하는 메모리 기반 DBMS
	- 작성언어 : ANSI C
	- 많은 언어들이 redis를 바인딩하고 포함
	- 외부층에서 redis의 데이터 모델은 키를 값에 맵핑하는 자료구조의 디렉토리
	- 다른 구조화된 저장 시스템 사이의 차이점
		- 스트링뿐만 아니라 자료구조의 추상적 자료형도 지원
	- '키-값' 구조의 비정형 데이터를 저장하고 관리
	-  Data Types
		1. strings
			+ 가장 기본적인 데이타형 
			+ key에 하나의 값을 저장
			+ 이진 데이타도 저장이 가능
				- 정수형, 실수형 이 따로 없다는 특징이 있다
			+ 한 key에 넣을 수 있는 데이타의 최대 크기는 512M
			+ 값은 정수인 경우는 int, 아니면 raw로 encoding
		2. Lists
			+ 배열과 유사
			+ 한 key에 넣을 수 있는 요소의 최대 개수는 4,294,967,295개(2^32 - 1)
			+ 값은 설정파일에서 정해준 조건보다 큰 경우는 linkedlist, 아니면 ziplist로 encoding
		3. Sets
			+ 정렬되지 않은 집합형
			+ 한 key 에 중복된 데이타는 존재하지 않는다 
			+ 중요한 장점
				- 요소의 추가, 제거 및 존재 체크 시 소모되는 시간이 sets에 포함된 요소의 수에 관계없이 일정
			+ 한 key에 넣을 수 있는 요소의 최대 개수는 4,294,967,295개(2^32 - 1)
			+ 값은 설정파일에서 정해준 조건보다 큰 경우는 hashtable, 아니면 intset로 encoding
		4. Hashes
			+ 암호화에서 설명한 그 hash 와는 무관
			+ 객체를 나타내는데 사용 가능
			+ 형태는 lists와 유사
				- "필드명", "필드값" 의 연속으로 구성	
			+ redis는 최대 100개 정도의 필드를 가지고 있는 hashes형의 데이타를 저장할 때, 매주 작은 메모리 공간을 사용하는 방법을 사용
			+ 한 key에 포함할 수 있는 field-value 쌍의 최대 개수는 4,294,967,295개(2^32 - 1)
			+ 값은 설정파일에서 정해준 조건보다 큰 경우는 hashtable, 아니면 zipmap로 encoding
		5. Sorted sets
			+ 형태 : sets의 각요소마다 score 라는 실수 값을 가지고 있다
				- 요소들은 정렬된 형태로 보여지는데 이때 정렬하는 기준이 score(오름차순)
			+ 동일한 key 에서 각 요소들의 값은 유일
				- 하지만 score 값은 중복 가능
			+ 요소의 추가, 제거, 업데이트는 매우 빠름
				- 가장 진보한 redis 데이타 형
			+ 값은 설정파일에서 정해준 조건보다 큰 경우는 skiplist, 아니면 ziplist로 encoding
	- 속도가 빠르고 database와 cache 모두로 사용 가능
		- 최고의 성능이 필요한 웹, 모바일, 게임, 광고 기술 및 IoT 애플리케이션에서 사용
	- 명시적으로 삭제, expire을 설정하기 않으면 데이터가 삭제되지 않아 영구보존 
		- expires : key의 만기시간 설정 명령
		- 만기시각이 지난 key는 자동 삭제
	- 지속성(Persistence)이 있다
		- redis는 메모리 기반 데이터베이스 이기 때문에 전원이 꺼지면 데이타가 모두 날라가게 되는 문제가 있다
		- 따라서 이를 해결하기 위해, 파일 메모리상의 데이터를 저장해두고 redis 서버 실행시 다시 그 파일에서 데이터를 읽어와 메모리상에 올리는 기능을 제공하는 기능
	- 사용 사례
		- 캐싱, 세션 관리, pub/sub 및 순위표
	- 가장 인기 있는 키-값 저장소
		- by DB-Engines.com의 월간 랭킹

### 4. Database

* MySQL
	- Oracle 소유
	- 리눅스에 설치되는 APM 패키지에 포함될 정도로 점유율이 아주 높다
	- 한국에서는 제로보드와 그누보드에서 지원
	- 하지만 최근 구글 vs Oracle의 java 저작권 소송 때문에 많은 기업들이 MariaDB로 넘어가고 있다

* MariaDB
	- MySQL을 모태로 만든 DBMS

* Oracle database
	- 가장 앞선 기술과 안정성
	- 관계형 DBMS

## 3. 내가 선택한 기술과 이유

### 1. client : 안드로이드

* 우리나라의 OS 시장 점유율이 가장 높아 대중적으로 게임을 홍보할 수 있다
* 따라서 게임 이용자를 늘리는데 효과적일 것이다

### 2. server : Apache

* 우리가 제작하고 있는 게임
	- 1인 비동기식 게임
	- 게임플레이가 대부분 폰에서 처리된다
	- 클라이언트의 상태를 지속적으로 관찰할 필요가 없다
* 따라서 웹서버가 유리하므로 웹서버 프로그램인 Apache 사용
* 왜냐하면, 우리가 사용하는 database인 MariaDB와 잘 호환된다
* 최근 속도가 크게 개선된 Event MPM 탑재버전이 나와 성능이 좋다


### 3. cache server : 사용하지 않음

* 캐시서버는 인터넷 사용자와 가까이 있는 서버로서, 인터넷 트래픽을 획기적으로 줄일 수 있다
* 하지만 우리의 게임은 1인 유저 게임이고, 인디게임이라 이용자도 아주 많지 않을 것이다
* 따라서 큰 트래픽을 관리할 서버가 필요하지 않을 것이다

### 4. database : MariaDB

* 아무래도 소규모 개발자로써 게임을 제작하기 때문에 금전적인 문제가 많은 영향을 끼친다
* 또한 현재 제작하고 있는 게임은 1인 유저 게임이라 database 서버가 큰 영향을 미치지 않을 것이다
* 따라서 금전적 부담이 적은 오픈소스 DBMS인 MariaDB를 사용한다
